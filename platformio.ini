[platformio]
default_envs = esp32s3_arduino_detection_test

; 共通設定
[env]
monitor_speed = 115200
lib_ldf_mode = deep+
# SDL2を使うnative環境向け: システムにSDL2がインストールされている前提
# macOS (Homebrew) の場合の典型的なフラグ。環境に合わせて要調整。
# brew install sdl2 してから、ターミナルで sdl2-config --cflags --libs を実行して確認できるよ！
lib_deps =
build_flags =

; ターゲットボード設定
[target_esp32s3_arduino]
platform = espressif32
board = esp32s3box
framework = arduino
build_flags =
  -DARDUINO_ESP32S3_DEV

# 新しく native ターゲットを追加！
[target_native]
platform = native
build_unflags = 
build_flags =
  -std=c++17 
  -Wall      
  !sdl2-config --cflags
link_flags =
  !sdl2-config --libs
lib_compat_mode = off 

; サンプル設定
[examples_detection_test]
build_src_filter = 
  +<*>
  +<../examples/detection_test/src/main.cpp>
build_flags =
  -D FLEXHAL_TEST_DETECTION

# --- NEW: build_test sample settings ---
[examples_build_test]
build_src_filter =
  +<*>
  +<../examples/build_test/src/main.cpp>
# No specific build flags needed for this simple test

; テスト用の基本設定
[test_base]
build_flags =
  -DFLEXHAL_TESTING
  -DFLEXHAL_TEST_ASSERT_ENABLE
  -I.

; Native環境でのテスト
[env:native_test]
extends = target_native
build_src_filter =
  +<*>
  +<../tests/unit/**/*.cpp>
build_flags =
  ${target_native.build_flags}
  ${test_base.build_flags}

; ESP32環境でのテスト
[env:esp32s3_test]
extends = target_esp32s3_arduino
build_src_filter =
  +<*>
  +<../tests/unit/**/*.cpp>
build_flags =
  ${target_esp32s3_arduino.build_flags}
  ${test_base.build_flags}

; 環境設定の組み合わせ
[env:esp32s3_arduino_detection_test]
extends = target_esp32s3_arduino
build_src_filter = ${examples_detection_test.build_src_filter}
build_flags =
  ${target_esp32s3_arduino.build_flags}
  ${examples_detection_test.build_flags}

[env:native_detection_test]
extends = target_native, examples_detection_test
build_flags =
  -std=c++17
  -Wall
  ${target_native.build_flags}
  ${examples_detection_test.build_flags}

# --- NEW: build_test environments ---
[env:esp32s3_arduino_build_test]
extends = target_esp32s3_arduino
build_src_filter = ${examples_build_test.build_src_filter}
build_flags =
  ${target_esp32s3_arduino.build_flags}
  # Add any build_test specific flags here if needed later

[env:native_build_test]
extends = target_native
build_src_filter = ${examples_build_test.build_src_filter}
build_flags =
  ${target_native.build_flags}
  # Add any build_test specific flags here if needed later

# Linker flags specific to this test environment (if any)
# link_flags =
#   ${target_native.link_flags}
#   ${examples_detection_test.link_flags}

# FlexHAL Overview

## 🎯 プロジェクトの目標

FlexHALは、以下の目標を掲げて開発されているハードウェア抽象化ライブラリです：

- **Write Once, Run Anywhere**: 同じコードで多くの組み込みマイコンやデスクトップOSで動作
- **Simple to Advanced**: Arduino初心者から組み込み開発のプロフェッショナルまで、幅広いユーザーに対応
- **Modern C++**: C++14以上の機能を活用し、安全で効率的なコードを実現
- **高い移植性**: 新しいマイコンやOSへのポーティングを容易に

## 💻 対応環境

### ビルド環境
- Arduino IDE
- PlatformIO
- ESP-IDF

### 主なターゲットプラットフォーム
- ESP32シリーズ
- RP2040
- AVR
- デスクトップOS (SDL2を使用)

## 🔧 主な機能と特徴

### 機能の提供方法
- namespace `flexhal` による関数群
- `FlexHAL` クラスのメンバーとしてのインスタンス提供を予定
- 将来的にC言語向けラッパーも提供予定



### 抽象化レイヤー
1. **環境依存のない汎用部**
   - 共通インターフェース
   - ユーティリティ
   - フォールバック実装
2. **プラットフォーム依存部**
   - マイコンチップ固有の実装
   - アーキテクチャ固有の実装
3. **フレームワーク依存部**
   - Arduino
   - ESP-IDF
   - CMSIS
4. **RTOS依存部**
   - FreeRTOS
   - Zephyr

### 特筆すべき機能
- **マルチ実装**: 同種の機能に複数の実装が用意され、任意の実装を利用できる
  - Arduino実装・ESP-IDF実装・ネイティブ実装・ソフトウェア実装・ユーザー独自実装などを機能ごとに選択可能
- **デスクトップテスト**: SDL2を使用してデスクトップ上でマイコンアプリの開発・テストが可能
- **リモートHAL**: ネットワーク越しに別デバイス上のHALを制御可能
  - デスクトップOS向けにビルドしたアプリからマイコン上のHALを制御
  - マイコン上で複数のFlexHALインスタンスを作成し、別のマイコンのHALを制御
- **ネイティブAPI**: 抽象化によるオーバーヘッドを避けたい場合のための直接的なAPI

## 🛠️ 設計方針

### コーディング規約
- スマートポインタを優先し、生ポインタの使用は避ける
- エラー処理はエラーコードベース (例外を使用しない)
- 環境依存の実装や内部実装は `flexhal::internal` 名前空間に隔離

### 品質管理
- PlatformIOによる自動ビルドテスト
- 複数の環境での動作検証
- ドキュメントの整備・保守

## 📚 詳細設計

詳細な設計情報は、以下のドキュメントを参照してください：

- [フォルダ構造](01_Folder_Structure.md)
- [名前空間ルール](02_Namespace_Rules.md)
- [検出・インクルードの仕組み](03_Detection_Inclusion.md)
- [ヘッダ内実装のルール](04_Header_Implementation.md)
- [API仕様のルール](05_API_Rules.md)
- [命名規則](06_Naming_Convention.md)
